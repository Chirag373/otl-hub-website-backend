<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard | OTL Platform</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arima:wght@100..700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.23/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Arima', 'system-ui', 'sans-serif'],
                        heading: ['Arima', 'system-ui', 'sans-serif'],
                        body: ['Arima', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        border: "var(--border)",
                        input: "var(--input)",
                        ring: "var(--ring)",
                        background: "var(--background)",
                        foreground: "var(--foreground)",
                        primary: {
                            DEFAULT: "var(--primary)",
                            foreground: "var(--primary-foreground)",
                        },
                        muted: {
                            DEFAULT: "var(--muted)",
                            foreground: "var(--muted-foreground)",
                        },
                        accent: {
                            DEFAULT: "var(--accent)",
                            foreground: "var(--accent-foreground)",
                            hover: "var(--accent-hover)",
                        },
                        card: {
                            DEFAULT: "var(--card)",
                            foreground: "var(--card-foreground)",
                        },
                    },
                }
            }
        }
    </script>

    <style>
        :root {
            --radius: 0.625rem;
            --bg: #2a2a2a;
            --card: #3a3a3a;
            --muted: #c0c0c0;
            --accent: #d4af37;
            --accent-hover: #e0c066;
            --border: #4a4a4a;

            --background: #2a2a2a;
            --foreground: #f3f4f6;
            --card-foreground: #f3f4f6;
            --popover: #3a3a3a;
            --popover-foreground: #f3f4f6;
            --primary: #d4af37;
            --primary-foreground: #2a2a2a;
            --secondary: #464646;
            --secondary-foreground: #f3f4f6;
            --muted: #464646;
            --muted-foreground: #c0c0c0;
            --accent-foreground: #2a2a2a;
            --destructive: #dc2626;
            --input: #464646;
            --ring: #d4af37;
        }

        body {
            background-color: var(--bg);
            color: var(--foreground);
            font-family: 'Arima', sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>

<body class="min-h-screen bg-[var(--bg)]">

    <div
        class="lg:hidden fixed top-0 left-0 right-0 z-50 bg-[var(--card)] border-b border-[var(--border)] px-4 py-3 flex items-center justify-between">
        <span class="font-bold text-lg text-[var(--foreground)]">OTL Dashboard</span>
        <button id="mobile-menu-btn"
            class="btn btn-square btn-ghost btn-sm text-[var(--foreground)]">
            <i data-lucide="menu" class="w-5 h-5"></i>
        </button>
    </div>

    <aside id="sidebar"
        class="fixed inset-y-0 left-0 z-40 w-64 bg-[var(--card)] border-r border-[var(--border)] transform -translate-x-full lg:translate-x-0 sidebar-transition flex flex-col">
        <div class="flex items-center justify-center h-16 px-6 border-b border-[var(--border)]">
            <h1 class="font-heading text-xl font-bold text-[var(--foreground)]">
                OTL Dashboard
            </h1>
        </div>

        <div class="px-6 py-4 border-b border-[var(--border)]">
            <div class="flex items-center space-x-3">
                <div class="avatar placeholder">
                    <div class="bg-[var(--accent)] text-[var(--bg)] rounded-full w-10">
                        <span id="sidebar-avatar-initials" class="text-sm font-semibold">AS</span>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <p id="sidebar-user-name" class="text-sm font-medium text-[var(--foreground)] truncate">Alice Smith
                    </p>
                    <p class="text-xs text-[var(--muted-foreground)] truncate capitalize">Seller</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 px-4 py-6 space-y-2">
            <a href="#"
                class="btn btn-ghost w-full justify-start bg-[var(--accent)] text-[var(--bg)] hover:bg-[var(--accent-hover)]">
                <i data-lucide="home" class="mr-3 h-4 w-4"></i> Dashboard
            </a>
            <a href="#"
                class="btn btn-ghost w-full justify-start text-[var(--foreground)] hover:bg-[var(--accent)] hover:text-black">
                <i data-lucide="building" class="mr-3 h-4 w-4"></i> My Properties
            </a>
            <a href="#"
                class="btn btn-ghost w-full justify-start text-[var(--foreground)] hover:bg-[var(--accent)] hover:text-black">
                <i data-lucide="message-square" class="mr-3 h-4 w-4"></i> Messages
            </a>
            <a href="#"
                class="btn btn-ghost w-full justify-start text-[var(--foreground)] hover:bg-[var(--accent)] hover:text-black">
                <i data-lucide="settings" class="mr-3 h-4 w-4"></i> Settings
            </a>
        </nav>

        <div class="p-4 border-t border-[var(--border)]">
            <a href="{% url 'login' %}"
                class="btn btn-ghost w-full justify-start text-[var(--foreground)] hover:bg-yellow-500 hover:text-black">
                <i data-lucide="log-out" class="mr-3 h-4 w-4"></i> Sign Out
            </a>
        </div>
    </aside>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden lg:hidden"></div>

    <div class="lg:pl-64 pt-16 lg:pt-0">
        <main class="min-h-screen bg-[var(--bg)]">
            <div class="w-full max-w-7xl mx-auto px-6 py-8 space-y-6">

                <div class="space-y-2">
                    <h1 class="text-3xl font-bold text-[var(--foreground)]">Welcome back!</h1>
                    <p class="text-[var(--muted-foreground)]">Manage your property listings and track offers</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card bg-[var(--card)] border border-[var(--border)] shadow-sm">
                        <div class="card-body p-6 flex-row items-center space-x-4">
                            <div class="p-3 bg-green-100/10 rounded-lg text-green-400">
                                <i data-lucide="eye" class="h-6 w-6"></i>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--muted-foreground)]">Total Views</p>
                                <p id="stat-total-views" class="text-2xl font-bold text-[var(--foreground)]">390</p>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-[var(--card)] border border-[var(--border)] shadow-sm">
                        <div class="card-body p-6 flex-row items-center space-x-4">
                            <div class="p-3 bg-yellow-100/10 rounded-lg text-yellow-400">
                                <i data-lucide="clock" class="h-6 w-6"></i>
                            </div>
                            <div>
                                <p class="text-sm text-[var(--muted-foreground)]">Avg Days on Market</p>
                                <p id="stat-avg-days" class="text-2xl font-bold text-[var(--foreground)]">45</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card bg-[var(--card)] border border-[var(--border)] shadow-xl">
                    <div class="card-body p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-4">
                                <div class="avatar placeholder">
                                    <div class="bg-[var(--accent)] text-[var(--bg)] rounded-full w-16">
                                        <span id="profile-avatar-initials" class="text-xl font-bold">AS</span>
                                    </div>
                                    <button
                                        class="absolute -bottom-1 -right-1 btn btn-circle btn-xs border border-[var(--border)] bg-[var(--card)] hover:bg-[var(--muted)]">
                                        <i data-lucide="camera" class="h-3 w-3 text-[var(--foreground)]"></i>
                                    </button>
                                </div>
                                <div>
                                    <h3 id="profile-display-name" class="font-semibold text-[var(--foreground)] text-lg">
                                        Alice Smith</h3>
                                    <p class="text-sm text-[var(--muted-foreground)]">Property Seller</p>
                                    <div class="flex items-center space-x-1 text-xs text-[var(--muted-foreground)] mt-1">
                                        <i data-lucide="calendar" class="h-3 w-3"></i>
                                        <span id="profile-member-since">Member since Jan 2025</span>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-2">
                                <button id="btn-edit-profile"
                                    class="btn btn-outline border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--muted)] hover:text-[var(--foreground)] btn-sm">
                                    <i data-lucide="edit" class="mr-2 h-4 w-4"></i> Edit Profile
                                </button>
                                <div id="edit-actions" class="hidden flex space-x-2">
                                    <button id="btn-cancel-profile"
                                        class="btn btn-ghost btn-sm text-[var(--foreground)]">
                                        <i data-lucide="x" class="mr-2 h-4 w-4"></i> Cancel
                                    </button>
                                    <button id="btn-save-profile"
                                        class="btn btn-primary btn-sm bg-[var(--accent)] text-[var(--bg)] border-none hover:bg-[var(--accent-hover)]">
                                        <i data-lucide="save" class="mr-2 h-4 w-4"></i> Save
                                    </button>
                                </div>
                            </div>
                        </div>

                        <h3 class="text-lg font-semibold text-[var(--foreground)] mb-4">Personal Information</h3>

                        <form id="profile-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">First Name</span>
                                </label>
                                <input type="text" id="input-first-name"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Last Name</span>
                                </label>
                                <input type="text" id="input-last-name"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Email Address</span>
                                </label>
                                <input type="email" id="input-email"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Phone Number</span>
                                </label>
                                <input type="tel" id="input-phone"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Address Number</span>
                                </label>
                                <input type="text" id="input-addr-number"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Street Address</span>
                                </label>
                                <input type="text" id="input-street"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">City</span>
                                </label>
                                <input type="text" id="input-city"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">State</span>
                                </label>
                                <input type="text" id="input-state"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">ZIP Code</span>
                                </label>
                                <input type="text" id="input-zip"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">County</span>
                                </label>
                                <input type="text" id="input-county"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Property Type</span>
                                </label>
                                <input type="text" id="input-prop-type"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>
                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Estimated Value</span>
                                </label>
                                <input type="text" id="input-est-value"
                                    class="input input-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                            </div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Reason for Selling</span>
                                </label>
                                <select id="input-reason"
                                    class="select select-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                                    <option value="Foreclosure">Foreclosure</option>
                                    <option value="Retirement">Retirement</option>
                                    <option value="Relocation">Relocation</option>
                                    <option value="Leisure">Leisure</option>
                                    <option value="Investment">Investment</option>
                                </select>
                            </div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Selling Type</span>
                                </label>
                                <select id="input-selling-type"
                                    class="select select-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)]"
                                    disabled>
                                    <option value="With Real Estate Agent">With Real Estate Agent</option>
                                    <option value="For Sale By Owner">For Sale By Owner</option>
                                    <option value="Short Sale">Short Sale</option>
                                    <option value="Foreclosure">Foreclosure</option>
                                    <option value="Auction">Auction</option>
                                </select>
                            </div>

                            <div class="form-control w-full md:col-span-2">
                                <label class="label">
                                    <span class="label-text text-[var(--foreground)] font-medium">Property Description</span>
                                </label>
                                <textarea id="input-description" rows="4"
                                    class="textarea textarea-bordered w-full bg-[var(--input)] border-[var(--border)] text-[var(--foreground)] disabled:opacity-50 disabled:bg-[var(--input)] disabled:text-[var(--muted-foreground)] focus:outline-none focus:border-[var(--accent)] resize-none"
                                    disabled></textarea>
                            </div>

                            <div class="form-control w-full md:col-span-2">
                                <div class="bg-[var(--muted)]/20 rounded-lg p-4 border border-[var(--border)]">
                                    <div class="flex items-start space-x-3">
                                        <div id="leaseback-icon-container"
                                            class="p-2 rounded-lg bg-gray-100 transition-colors">
                                            <i data-lucide="home" id="leaseback-icon"
                                                class="h-5 w-5 text-gray-500 transition-colors"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="label cursor-pointer justify-start gap-3 p-0">
                                                    <input type="checkbox" id="input-leaseback" class="checkbox checkbox-accent checkbox-sm"
                                                        disabled>
                                                    <span class="text-sm font-medium text-[var(--foreground)]">Leaseback Required</span>
                                                </label>
                                            </div>
                                            <p class="text-xs text-[var(--muted-foreground)] mb-3">
                                                Request to continue living in the property after closing for a specified
                                                period
                                            </p>
                                            <div id="leaseback-alert"
                                                class="hidden alert bg-[var(--accent)]/5 border-[var(--accent)]/10 text-[var(--accent)] p-2 text-xs flex-row">
                                                <i data-lucide="alert-circle" class="h-4 w-4"></i>
                                                <span class="font-medium">Leaseback terms will be negotiated with the buyer</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div id="save-notification" class="hidden mt-4 p-4 rounded-lg border"></div>
                    </div>
                </div>

                <div class="card bg-[var(--card)] border border-[var(--border)] shadow-xl">
                    <div class="card-body p-6">
                        <h3 class="text-lg font-semibold text-[var(--foreground)] mb-4">Membership Subscription</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="form-control w-full">
                                    <label class="label">
                                        <span class="label-text text-[var(--foreground)] font-medium">Member Since</span>
                                    </label>
                                    <div
                                        class="flex items-center space-x-2 px-3 py-3 bg-[var(--muted)]/30 rounded-lg border border-[var(--border)]">
                                        <i data-lucide="calendar" class="h-4 w-4 text-[var(--muted-foreground)]"></i>
                                        <span id="sub-member-since" class="text-[var(--foreground)] text-sm">--</span>
                                    </div>
                                </div>
                                <div class="form-control w-full">
                                    <label class="label">
                                        <span class="label-text text-[var(--foreground)] font-medium">Expiration Date</span>
                                    </label>
                                    <input type="text" id="sub-expiration" disabled
                                        class="input input-bordered w-full bg-[var(--muted)]/30 border-[var(--border)] text-[var(--foreground)] opacity-70">
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="form-control w-full">
                                    <label class="label">
                                        <span class="label-text text-[var(--foreground)] font-medium">Fee Paid</span>
                                    </label>
                                    <input type="text" id="sub-fee" disabled
                                        class="input input-bordered w-full bg-[var(--muted)]/30 border-[var(--border)] text-[var(--foreground)] font-semibold opacity-70">
                                </div>
                                <div class="form-control w-full">
                                    <label class="label">
                                        <span class="label-text text-[var(--foreground)] font-medium">Property Access</span>
                                    </label>
                                    <div
                                        class="flex items-center space-x-2 px-3 py-3 bg-[var(--muted)]/30 rounded-lg border border-[var(--border)]">
                                        <span id="sub-access" class="text-[var(--foreground)] font-semibold text-sm">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 alert bg-blue-50/10 border-blue-500/30 text-blue-300 text-sm">
                            <i data-lucide="info" class="h-4 w-4"></i>
                            <span><strong>Your membership</strong> gives you access to listing your property and connecting with potential buyers.</span>
                        </div>
                    </div>
                </div>

                <div class="card bg-[var(--card)] border border-[var(--border)] shadow-xl">
                    <div class="card-body p-6">
                        <h2 class="card-title text-xl font-semibold text-[var(--foreground)] mb-4">Recent Contact</h2>
                        <div id="contact-list" class="space-y-3">
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- DATA ---
        let profile = {
            first_name: "Alice",
            last_name: "Smith",
            email: "alice.smith@example.com",
            phone_number: "(555) 987-6543",
            member_since: "2025-01-20",
            address_number: "123",
            street_address: "Maple Avenue",
            city: "Austin",
            state: "TX",
            zip_code: "78701",
            county: "Travis",
            property_type: "Single Family",
            property_description: "Beautiful renovated home with spacious backyard...",
            estimated_value: "$450,000",
            reason_for_selling: "Relocation",
            selling_type: "For Sale By Owner",
            leaseback_required: true,
            subscription: {
                member_since: "2025-01-20",
                expiration_date: "2025-07-20",
                fee_paid: "298.00",
                property_access: "Listing Access"
            }
        };

        const contacts = [
            { id: 1, buyerName: "John Smith", phone: "(555) 123-4567", email: "john.smith@email.com" },
            { id: 2, buyerName: "Sarah Johnson", phone: "(555) 987-6543", email: "sarah.johnson@email.com" },
            { id: 3, buyerName: "Mike Chen", phone: "(555) 456-7890", email: "mike.chen@email.com" }
        ];

        // --- DOM ELEMENTS ---
        const dom = {
            mobileMenuBtn: document.getElementById('mobile-menu-btn'),
            sidebar: document.getElementById('sidebar'),
            overlay: document.getElementById('sidebar-overlay'),

            // Profile Display
            avatarInitials: document.getElementById('profile-avatar-initials'),
            sidebarInitials: document.getElementById('sidebar-avatar-initials'),
            displayName: document.getElementById('profile-display-name'),
            sidebarName: document.getElementById('sidebar-user-name'),
            memberSince: document.getElementById('profile-member-since'),

            // Form Inputs
            inputFirstName: document.getElementById('input-first-name'),
            inputLastName: document.getElementById('input-last-name'),
            inputEmail: document.getElementById('input-email'),
            inputPhone: document.getElementById('input-phone'),
            inputAddrNumber: document.getElementById('input-addr-number'),
            inputStreet: document.getElementById('input-street'),
            inputCity: document.getElementById('input-city'),
            inputState: document.getElementById('input-state'),
            inputZip: document.getElementById('input-zip'),
            inputCounty: document.getElementById('input-county'),
            inputPropType: document.getElementById('input-prop-type'),
            inputEstValue: document.getElementById('input-est-value'),
            inputReason: document.getElementById('input-reason'),
            inputSellingType: document.getElementById('input-selling-type'),
            inputDescription: document.getElementById('input-description'),
            inputLeaseback: document.getElementById('input-leaseback'),

            // Leaseback UI
            leasebackIconContainer: document.getElementById('leaseback-icon-container'),
            leasebackIcon: document.getElementById('leaseback-icon'),
            leasebackAlert: document.getElementById('leaseback-alert'),

            // Subscription
            subMemberSince: document.getElementById('sub-member-since'),
            subExpiration: document.getElementById('sub-expiration'),
            subFee: document.getElementById('sub-fee'),
            subAccess: document.getElementById('sub-access'),

            // Actions
            btnEdit: document.getElementById('btn-edit-profile'),
            btnCancel: document.getElementById('btn-cancel-profile'),
            btnSave: document.getElementById('btn-save-profile'),
            editActions: document.getElementById('edit-actions'),
            saveNotification: document.getElementById('save-notification'),

            contactList: document.getElementById('contact-list')
        };

        // --- INITIALIZATION ---
        function init() {
            lucide.createIcons();
            populateData();
            renderContacts();
            setupEventListeners();
        }

        // --- LOGIC ---

        function populateData() {
            // Text Elements
            const fullName = `${profile.first_name} ${profile.last_name}`;
            const initials = (profile.first_name[0] + profile.last_name[0]).toUpperCase();

            dom.avatarInitials.textContent = initials;
            dom.sidebarInitials.textContent = initials;
            dom.displayName.textContent = fullName;
            dom.sidebarName.textContent = fullName;
            dom.memberSince.textContent = `Member since ${profile.member_since}`;

            // Inputs
            dom.inputFirstName.value = profile.first_name;
            dom.inputLastName.value = profile.last_name;
            dom.inputEmail.value = profile.email;
            dom.inputPhone.value = profile.phone_number;
            dom.inputAddrNumber.value = profile.address_number;
            dom.inputStreet.value = profile.street_address;
            dom.inputCity.value = profile.city;
            dom.inputState.value = profile.state;
            dom.inputZip.value = profile.zip_code;
            dom.inputCounty.value = profile.county;
            dom.inputPropType.value = profile.property_type;
            dom.inputEstValue.value = profile.estimated_value;
            dom.inputReason.value = profile.reason_for_selling;
            dom.inputSellingType.value = profile.selling_type;
            dom.inputDescription.value = profile.property_description;
            dom.inputLeaseback.checked = profile.leaseback_required;

            updateLeasebackUI(profile.leaseback_required);

            // Subscription
            dom.subMemberSince.textContent = profile.subscription.member_since;
            dom.subExpiration.value = profile.subscription.expiration_date;
            dom.subFee.value = `$${profile.subscription.fee_paid}`;
            dom.subAccess.textContent = profile.subscription.property_access;
        }

        function updateLeasebackUI(isChecked) {
            if (isChecked) {
                dom.leasebackIconContainer.classList.add('bg-[var(--accent)]/10');
                dom.leasebackIconContainer.classList.remove('bg-gray-100');
                dom.leasebackIcon.classList.add('text-[var(--accent)]');
                dom.leasebackIcon.classList.remove('text-gray-500');
                dom.leasebackAlert.classList.remove('hidden');
            } else {
                dom.leasebackIconContainer.classList.remove('bg-[var(--accent)]/10');
                dom.leasebackIconContainer.classList.add('bg-gray-100');
                dom.leasebackIcon.classList.remove('text-[var(--accent)]');
                dom.leasebackIcon.classList.add('text-gray-500');
                dom.leasebackAlert.classList.add('hidden');
            }
        }

        function renderContacts() {
            dom.contactList.innerHTML = contacts.map(contact => `
                <div class="flex items-center justify-between p-3 bg-[var(--muted)]/30 rounded-lg border border-[var(--border)]">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-[var(--accent)] rounded-full flex items-center justify-center">
                            <i data-lucide="users" class="h-5 w-5 text-[var(--bg)]"></i>
                        </div>
                        <div>
                            <p class="font-medium text-[var(--foreground)]">${contact.buyerName}</p>
                            <div class="flex items-center space-x-4 text-sm text-[var(--muted-foreground)]">
                                <span class="flex items-center"><i data-lucide="phone" class="h-3 w-3 mr-1"></i> ${contact.phone}</span>
                                <span class="flex items-center"><i data-lucide="mail" class="h-3 w-3 mr-1"></i> ${contact.email}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="btn btn-xs btn-outline border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--muted)]">
                            <i data-lucide="phone" class="h-3 w-3 mr-1"></i> Call
                        </button>
                        <button class="btn btn-xs btn-outline border-[var(--border)] text-[var(--foreground)] hover:bg-[var(--muted)]">
                            <i data-lucide="mail" class="h-3 w-3 mr-1"></i> Email
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            // Sidebar
            const toggleSidebar = () => {
                const isClosed = dom.sidebar.classList.contains('-translate-x-full');
                if (isClosed) {
                    dom.sidebar.classList.remove('-translate-x-full');
                    dom.overlay.classList.remove('hidden');
                } else {
                    dom.sidebar.classList.add('-translate-x-full');
                    dom.overlay.classList.add('hidden');
                }
            };
            dom.mobileMenuBtn.addEventListener('click', toggleSidebar);
            dom.overlay.addEventListener('click', toggleSidebar);

            // Edit Profile
            dom.btnEdit.addEventListener('click', () => setEditMode(true));
            dom.btnCancel.addEventListener('click', () => {
                setEditMode(false);
                populateData(); // Reset
            });
            dom.btnSave.addEventListener('click', (e) => {
                e.preventDefault();
                saveProfile();
            });

            // Leaseback Checkbox
            dom.inputLeaseback.addEventListener('change', (e) => {
                updateLeasebackUI(e.target.checked);
            });
        }

        function setEditMode(isEditing) {
            dom.btnEdit.parentElement.classList.toggle('hidden', isEditing);
            dom.editActions.classList.toggle('hidden', !isEditing);

            const inputs = document.querySelectorAll('#profile-form input:not([type="checkbox"]), #profile-form select, #profile-form textarea');
            inputs.forEach(input => input.disabled = !isEditing);
            dom.inputLeaseback.disabled = !isEditing;
        }

        function saveProfile() {
            dom.btnSave.innerHTML = `<span class="loading loading-spinner loading-xs"></span> Saving...`;
            
            setTimeout(() => {
                // Update Local Data
                profile.first_name = dom.inputFirstName.value;
                profile.last_name = dom.inputLastName.value;
                profile.email = dom.inputEmail.value;
                profile.phone_number = dom.inputPhone.value;
                profile.address_number = dom.inputAddrNumber.value;
                profile.street_address = dom.inputStreet.value;
                profile.city = dom.inputCity.value;
                profile.state = dom.inputState.value;
                profile.zip_code = dom.inputZip.value;
                profile.county = dom.inputCounty.value;
                profile.property_type = dom.inputPropType.value;
                profile.estimated_value = dom.inputEstValue.value;
                profile.reason_for_selling = dom.inputReason.value;
                profile.selling_type = dom.inputSellingType.value;
                profile.property_description = dom.inputDescription.value;
                profile.leaseback_required = dom.inputLeaseback.checked;

                // UI Updates
                populateData();
                setEditMode(false);

                dom.btnSave.innerHTML = `<i data-lucide="save" class="mr-2 h-4 w-4"></i> Save`;
                lucide.createIcons();

                // Success Message
                dom.saveNotification.className = "mt-4 alert alert-success text-sm";
                dom.saveNotification.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i> <span>Profile updated successfully!</span>`;
                dom.saveNotification.classList.remove('hidden');
                lucide.createIcons();

                setTimeout(() => {
                    dom.saveNotification.classList.add('hidden');
                }, 3000);
            }, 1000);
        }

        init();
    </script>
</body>

</html>